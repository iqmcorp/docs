import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CopyUrl from '@site/src/components/CopyUrl';
import CodeDropdown, { CodeOption } from '@site/src/components/CodeDropdown';

### Create Matched Audience

<CopyUrl method="POST" url="https://api.iqm.com/api/v3/audience/matched" />

<div class="endpoint-container">
  <div class="child1">

Create a Matched Audience by uploading a file with user data. The metadata is sent as a JSON string in the <var>audienceRequest</var> form data field, and the file is uploaded as multipart/form-data in the <var>file</var> form data field.

| Request Schema | |
| --- | --- |
| `audienceRequest` <br /><span class="type-text">form data</span> <span class="required-text">required</span> | Audience metadata details
| `file` <br /><span class="type-text">multipart/form-data</span> <span class="required-text">required</span> | File to be uploaded

<details className="objectPropertiesDetails" style={{ maxWidth: "800px", padding: "1rem" }}>
  <summary style={{ fontSize: "16px" }}><var>audienceRequest</var> Properties</summary>

<table className="objectProperties">
<tr>
<td>`audienceName` <br /><span class="type-text">string</span></td>
<td>Audience Name</td>
</tr>
<tr>
<td>`fileRowCount` <br /><span class="type-text">integer</span></td>
<td>Number of rows in the file</td>
</tr>
<tr>
<td>`fileColumnCount` <br /><span class="type-text">integer</span></td>
<td>Number of columns in the file</td>
</tr>
<tr>
<td>`audienceSubtypeId` <br /><span class="type-text">integer</span></td>
<td>[Audience Subtype ID](/guidelines/audience-api/#audience-subtype-list)</td>
</tr>
<tr>
<td>`columnMappings` <br /><span class="type-text">array</span></td>
<td>Array of column mapping objects</td>
</tr>
<tr>
<td colSpan="2">
  <details className="objectPropertiesDetails">
  <summary>`columnMappings` object properties</summary>
  <table className="objectProperties">
  <tr>
  <td>`columnId` <br /><span class="type-text">integer</span></td>
  <td>[Column ID](/guidelines/audience-api/#matched-column-list)</td>
  </tr>
    <tr>
  <td>`fileColumnName` <br /><span class="type-text">string</span></td>
  <td>File column name</td>
  </tr>
    <tr>
  <td>`dataFormatId` <br /><span class="type-text">integer</span></td>
  <td>[Data Format ID](/guidelines/audience-api/#data-formats-list-for-matched-audience)</td>
  </tr>
  </table></details>
  </td>
  <td></td>
</tr>
<tr>
<td>`dataPartnerId` <br /><span class="type-text">integer</span></td>
<td>[Data Partner ID]()</td>
</tr>
<tr>
<td>`columnCombinationId` <br /><span class="type-text">integer</span></td>
<td>Column Combination ID</td>
</tr>
</table>
</details>

<p /><details className="objectPropertiesDetails" style={{ maxWidth: "800px", padding: "1rem" }}>
<summary><var>audienceRequest</var> sample object for Political Matched Audience</summary>
```json
{
  "audienceName": "matched-audience-example-fs",
  "fileRowCount": 5,
  "fileColumnCount": 10,
  "columnMappings": [
      {
          "columnId": 5,
          "fileColumnName": "l2-voter-id",
          "dataFormatId": null
      },
      {
          "columnId": 6,
          "fileColumnName": "email",
          "dataFormatId": 1
      }
  ],
  "dataPartnerId": 2,
  "columnCombinationId": 11
}
```
</details>

<p /><details className="objectPropertiesDetails" style={{ maxWidth: "800px", padding: "1rem" }}>
<summary><var>audienceRequest</var> sample object for Healthcare Matched Audience</summary>
```json
{
  "audienceName": "Revamped Healthcare Matched Audience 02",
  "dataPartnerId": 7,
  "audienceSubtypeId": 3,
  "columnMappings": [
      {
          "columnId": 18,
          "fileColumnName": "NPI_ID"
      }
  ],
  "fileRowCount": 19,
  "fileColumnCount": 1,
  "columnCombinationId": 14,
  "consentGiven": true
}
```
</details>


</div>
<div class="child2a">

<CodeDropdown>
<CodeOption label="Form Data Sample" default>
```http
POST /api/v3/audience/matched HTTP/1.1
Host: api.iqm.com
Authorization: Bearer 0ed52da8-24ab-44b1-bc88-7ea03a090d24
X-IAA-OW-ID: 1
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="audienceRequest"
Content-Type: application/json

{"audienceName":"Healthcare Patient Audience 2025","dataPartnerId":7,"audienceSubtypeId":3,"columnCombinationId":14,"fileRowCount":1200,"fileColumnCount":3,"consentGiven":true,"columnMappings":[{"columnId":18,"fileColumnName":"NPI_ID"},{"columnId":19,"fileColumnName":"first_name"},{"columnId":20,"fileColumnName":"last_name"}]}
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="patient-data.csv"
Content-Type: text/csv

[Binary CSV file data]
------WebKitFormBoundary7MA4YWxkTrZu0gW--
```
</CodeOption>
<CodeOption label="cURL Sample">
```bash
curl -X POST https://api.example.com/api/v3/audience/matched \
  -H "Authorization: Bearer 0ed52da8-24ab-44b1-bc88-7ea03a090d24" \
  -H "X-IAA-OW-ID: 1" \
  -F 'audienceRequest={"audienceName":"Healthcare Patient Audience 2025","dataPartnerId":7,"audienceSubtypeId":3,"columnCombinationId":14,"fileRowCount":1200,"fileColumnCount":3,"consentGiven":true,"columnMappings":[{"columnId":18,"fileColumnName":"NPI_ID"},{"columnId":19,"fileColumnName":"first_name"},{"columnId":20,"fileColumnName":"last_name"}]};type=application/json' \
  -F 'file=@/path/to/patient-data.csv;type=text/csv'
```
</CodeOption>
</CodeDropdown>

```json title="Response 200"
{
  "success": true,
  "data": {
    "matchedAudienceId": 12345,
    "message": "Matched audience created successfully"
  }
}
```

</div></div>

---

### Update Matched Audience 

<CopyUrl method="PATCH" url="https://api.iqm.com/api/v3/audience/matched/{audienceId}" />

<div class="endpoint-container">
  <div class="child1">

Update a Matched Audience. 

| Path Parameter | |
| --- | --- |
| `audienceId` <br /><span class="type-text">integer</span> | Matched [Audience ID](#audience-details-list)

| Request Schema | |
| --- | --- |
| `dataCost` <br /><span class="type-text">number</span> | Data cost
| `audienceStatusId` <br /><span class="type-text">integer</span> | [Audience Status ID](/guidelines/audience-api/#audience-status-list)
| `rejectionReason` <br /><span class="type-text">string</span> | Reason for rejection if updating status to `Rejected`


  <details className="objectPropertiesDetails" style={{ maxWidth: "100%", padding: "1rem"}}>
    <summary style={{fontSize: "16px"}}>Response Properties</summary>
    <table className="objectProperties">
    <tr>
    <td>`id` <br /><span class="type-text">integer</span></td>
    <td>Audience ID</td>
    </tr>
    <tr>
    <td>`message` <br /><span class="type-text">string</span></td>
    <td>Success message</td>
    </tr>
    </table>
    </details>

</div>
<div class="child2">

<Tabs>
<TabItem value="JSON" label="JSON" default>

```json title="Request Sample"
{
  "dataCost": 10,
  "audienceStatusId": 4,
  "rejectionReason": "Insufficient data quality."
}
```

```json title="Response 200"
{
  "statusCode": 200,
  "responseObject": {
    "id": 1,
    "message": "Your changes have been saved successfully"
  }
}
```

</TabItem>
<TabItem value="TypeScript" label="TypeScript">

See [TypeScript Prerequisites](/getting-started/typescript-prerequisites.mdx) for usage. 

```ts
import {
  getInstance
} from "prerequisites"

const axios = getInstance();

interface Responses {
  200: {
    content: {
      "application/json;charset=UTF-8": {
        statusCode: number;
        responseObject: {
          id: number;
          message: string;
        };
      };
    };
  };
}

function EditMatchedAudience(): Promise<Responses> {
  const options = {
    method: 'PATCH',
    url: 'https://api.iqm.com/api/v3/audience/matched/{audienceId}',
    params: {
      path: {
        audienceId: `string`
      }
    },
    requestBody: {
      content: {
        "application/json": {
          dataCost: `number`,
          audienceStatusId: `number`,
          rejectionReason: `string`
        }
      }
    }
  };

  return axios.request(options).then(({ data }: { data: Responses }) => data);
}
```

</TabItem></Tabs>

</div></div>
